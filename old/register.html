<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>马上飞扬-注册</title>
<meta name="description" content="马上飞扬计算机技术有限公司是黄浦区金融办重点支持的新型互联网金融公司。公司创新了整合线上线下资源，将理财产品、银行物理网点、银行理财顾问、手机银行置于一体的“马上理财金融信息平台”。">
<meta name="keywords" content="理财,银行,金融">
<link href="static/css/common.css" rel="stylesheet">
<script src="static/js/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="static/js/common.js" type="text/javascript"></script>
</head>

<body>
<div class="header header-other">
  <div class="content-wrap">
    <span class="logo"><a href="index.html"><img src="static/images/logo-header.png" alt="logo"></a></span>
  </div>
  <span class="border"></span>
</div>
<!--/end header-->
<div class="main-content p-register">
  <div class="register-box"> 
    <h2>欢迎注册</h2>
    <form name="register" id="register" method="post" action="">
      <dl class="clearfix">
        <dt>手机号：</dt>
        <dd><input type="text" name="username" id="username" class="input-default" placeholder="用于账户登录"></dd>
        <dd>
          <p class="tip"></p>
        </dd>
      </dl>
      <dl class="clearfix">
        <dt>密码：</dt>
        <dd><input type="password" name="password1" id="password1" class="input-default" placeholder="由6-15位数字、字母或特殊字符组成，区分大小写"></dd>
        <dd>
          <ul class="complexity clearfix" id="complexity">
            <li class="arrow"></li>
            <li class="first">弱</li>
            <li class="second">中</li>
            <li class="third">强</li>
          </ul>
          <p class="tip"></p>
        </dd>
      </dl>
      <dl class="clearfix">
        <dt>确认密码：</dt>
        <dd><input type="password" name="password2" id="password2" class="input-default" placeholder="再输入一次"></dd>
        <dd>
          <p class="tip"></p>
        </dd>
      </dl>
      <dl class="clearfix">
        <dt></dt>
        <dd>
          <input type="text" name="code" id="code" class="input-default short" placeholder="获取验证码">
          <span class="btn-code" id="btnCode">获取验证码</span>
        </dd>
      </dl>
      <p class="clearfix check-bar">
        <input type="checkbox" name="checkbox" id="checkbox" class="checkbox">
        <span class="txt">我已阅读并同意遵守<a href="javascript:;" id="showAgreement">马上理财用户协议</a></span>
      </p>
      <div class="btn-bar clearfix"><button type="submit" id="btnSubmit" class="btn-submit disable">同意协议并注册</button></div>
    </form>
    <p  class="had">已有账号 <a href="#">登录&gt;</a></p>
  </div>
  <div class="m-f-intro">
    <ul class="clearfix">
      <li class="item0">便捷银行开户，一步到位<span class="line">|</span></li>
      <li class="item1">各大银行理财产品，随心预约购买<span class="line">|</span></li>
      <li class="item2">稳健理财收益，安全放心</li>
    </ul>
  </div>
</div>
<!--/end main-content-->
<div class="footer">
  <div class="content-wrap">
    <span class="logo"><a href="index.html"><img src="static/images/logo-footer.png" alt="logo"></a></span>
    <ul class="links">
      <li class="phone">400-547-4578</li>
      <li class="about"><a href="#">关于马上理财</a></li>
      <li class="news"><a href="#">媒体报道</a></li>
      <li class="recruit"><a href="#">招贤纳士</a></li>
      <li class="contact"><a href="#">联系我们</a></li>
    </ul>
    <ul class="icos">
      <li><a href="javascript:;" title="微信" class="ico-weixin"></a></li>
      <li><a href="javascript:;" title="新浪" class="ico-xinlang"></a></li>
      <li><a href="javascript:;" title="知乎" class="ico-zhihu"></a></li>
      <li><a href="javascript:;" title="豆瓣" class="ico-douban"></a></li>
    </ul>
  </div>
</div>
<!--/end footer-->
<div class="m-pop-up m-pop-agreement" id="popAgreement">
  <div class="m-pop-mask"></div>
  <div class="m-pop-cont">
    <div class="close" id="agreementClose"></div>
    <div class="title">马上理财用户协议</div>
    <div class="content">
      <div class="agreement">
        <p>　　本协议是“马上理财”网站（网址为：www.mashanglc.com，以下简称网站）和“马上理财”客户端（以下简称客户端）注册会员（以下简称“用户”）与上海马上飞扬计算机技术有限公司（以下简称服务方）之间就用户通过服务方的网站及客户端了解各类理财产品信息并可以通过线下或者第三方支付平台购买理财产品等相关事宜所订立的契约。</p>
        <p>　　请用户仔细阅读本服务协议，用户勾选“我已阅读并同意”按钮后，本协议即构成对双方有约束力的法律文件。阅读本协议的过程中，如果您不同意本协议或其中任何条款约定，您应立即停止注册程序。</p>
        <p>一、 定义</p>
        <p>1.1 服务方的网站</p>
        <p>指由服务方开发、运营的互联网网站，其网址为www.mashanglc.com。</p>
      </div>
      <div class="clearfix check-bar">
        <input type="checkbox" class="checkbox">
        <span class="txt">我已阅读并同意遵守马上理财用户协议</span>
      </div>
      <div class="button-bar"><button class="btn btn-default">确定</button></div>
    </div>
  </div>
</div>
<!--/end 用户协议-->
<script src="static/js/validate.js" type="text/javascript"></script>
<!--mockjax.js模拟测试用，后端开发时请删除-->
<script src="static/js/jquery.mockjax.js" type="text/javascript"></script>
<script type="text/javascript">
  //模拟数据，后端开发时请删除
  $.mockjax({
    url: "users.action",
    response: function(settings) {
      var user = settings.data.username, users = ["15201151375", "13612341234", "13266666666"];
        this.responseText = "true";
      if ($.inArray(user, users) !== -1) {
        this.responseText = "false";
      }
    },
    responseTime: 500
  });
</script>
<script type="text/javascript">
  //注册验证
  $(function(){
    var $register = $("#register");
    var $allInput = $register.find('input[name="username"],input[name="password1"],input[name="password2"],input[name="code"]')
    var $username = $register.find('input[name="username"]');
    var $password1 = $register.find('input[name="password1"]');
    var $password2 = $register.find('input[name="password2"]');
    var $code = $register.find('input[name="code"]');
    var $checkbox = $register.find('input[name="checkbox"]');
    var $btnSubmit = $("#btnSubmit");
    var $btnCode = $("#btnCode");
    var $complexity = $("#complexity");
    var validate = new Validate();

    $username.on("blur",validateUsername);
    $password1.on("blur",validatePassword1);
    $password2.on("blur",validatePassword2);

    //侦听输入框keyup事件更新tip以及表单提交按钮的状态
    $allInput.on("keyup",function(){
      var $tip;
      if($(this).attr("name")!="code"){
        $tip = $(this).parents("dl").find('.tip');
        $tip.removeClass('wrong right').text("");
        if($(this).attr("name")=="password1"){
          $complexity.show();
          passwordStrength();
        }
      }   
      if($username.val()!="" && $password1.val()!="" && $password2.val()!="" && $code.val()!="" && $btnCode.hasClass("isget")){
        $btnSubmit.removeClass('disable');
      }else{
        $btnSubmit.addClass('disable');
      }
    })

    //获取验证码
    $btnCode.on("click",function(){
      if($(this).hasClass('disable') || !validateUsername()){
        return false;
      }
      //ajax获取验证码，获取成功后执行倒计时
      btnCodeCountdown(); 
    })

    //提交表单
    $btnSubmit.on("click",function(){
      if($(this).hasClass('disable')){
        return false;
      }
      var handle1 = validateUsername();
      var handle2 = validatePassword1();
      var handle3 = validatePassword2();

      if(!(handle1 && handle2 && handle3)){
        return false;
      }
      if(!$("#checkbox").attr("checked")){
        alert("为了保障您的合法权益，请注册前\n先阅读并同意马上理财用户协议");
        return false;
      }
      alert("前端验证全部通过，除了验证码\n正确性与有效性未做验证");
      //ajax提交form...无错误直接跳转页面
      //有错误则显示错误信息(弹出框待做...)
      return false;
    })
    

    //手机号（验证）
    function validateUsername(){       
        if(!validate.isNull($username,"手机号不能为空",validate.tipFuc)){
          return false;
        }
        if(!validate.isMobile($username,validate.tipFuc)){
          return false;
        }
        //users.action请改成后端地址，验证手机号是否存在
        //发送值为username:val,返回值只允许字符串"true"或者"false"
        if(!validate.remote($username,"users.action","手机号码已存在，请直接登录或者重新输入",validate.tipFuc)){
          return false;
        }
        validate.tipFuc($username,"",true);
        return true;
    }

    //密码（第一个验证）
    function validatePassword1(){
        if(!validate.isNull($password1,"密码不能为空",validate.tipFuc)){
          return false;
        }
        if(!validate.isPsd($password1,validate.tipFuc)){
          return false;
        }
        validate.tipFuc($password1,"",true);
        if($password1.hasClass('isTheSame')){
          validatePassword2();
        }
        return true;
    }

    //密码（第二个验证）
    function validatePassword2(){
      if(!validate.isNull($password2,"请再输入一次您的密码",validate.tipFuc)){
        return false;
      }
      if(!validate.isTheSame($password2,$password1,"两次密码输入不一致",validate.tipFuc)){
        return false;
      }
      validate.tipFuc($password2,"",true);
      return true;
    }

    //短信验证码验证（非空以及是否有获取过）
    function validateCode(){
        if(!$btnCode.hasClass("isget")){
          alert("请先获取验证码");
          return false; 
        }else if($code.val()==""){
          alert("请输入验证码");
          return false; 
        }      
        return true;   
    }

    //获取验证码倒计时
    function btnCodeCountdown(){ 
      var value = 59;
      var timer;
      $btnCode.addClass('isget');
      $btnCode.addClass('disable').text("60秒后可再次获取");
      timer = setInterval(function(){
        $btnCode.text(value+"秒可再次获取")
        value--;
        if(value<0){
          clearInterval(timer);
          $btnCode.removeClass('disable').text("获取验证码");
        }
      },1000)    
    }
    
    //密码强度判断
    function passwordStrength(){
      var value = $password1.val();
      var length = value.length;
      var level = 0;
      var mode = 0; 
      var charMode, charCode;
      if(length>=6 && length<=15){ 
        for (var i = 0; i < length; i++) {
          charCode = value.charCodeAt(i);
          // 判断输入密码的类型
          if (charCode >= 48 && charCode <= 57) {//数字  
            charMode = 1;
          }else if (charCode >= 65 && charCode <= 90){//大写  
            charMode = 2;
          } else if (charCode >= 97 && charCode <= 122){//小写  
            charMode = 4;
          }else{
            charMode = 8;//特殊字符
          }
          mode |= charMode;
        }
        // 计算密码模式
        for (i = 0; i < 4; i++) {
          if (mode & 1){
            level++;
          }
          mode >>>= 1;
        }
        switch (level) {
          case 1:
            $complexity.attr("class","complexity clearfix first");
            break;
          case 2:
            $complexity.attr("class","complexity clearfix second");
            break;
          case 3:
            $complexity.attr("class","complexity clearfix third");
            break;
          default:
            $complexity.attr("class","complexity clearfix");
            break;
        }
      }else{
        $complexity.attr("class","complexity clearfix");
      }
    }

  })
</script>
<script type="text/javascript">
  //用户协议
  $(function(){
    $("#showAgreement").on("click",function(){
      popUpPosition($("#popAgreement"));
      if(!$("#checkbox").attr("checked")){
        $("#popAgreement .checkbox").attr("checked",false);
      }else{
        $("#popAgreement .checkbox").attr("checked",true);
      }
    })

    //单击弹出框确认按钮
    $("#popAgreement .btn-default").on("click",function(){
      $("#popAgreement").css({"display":"none","opacity":0});
      if(!$("#popAgreement .checkbox").attr("checked")){
        $("#checkbox").attr("checked",false);
      }else{
        $("#checkbox").attr("checked",true);
      }
    })

    $("#agreementClose").on("click",function(){
      $("#popAgreement").css({"display":"none","opacity":0});
    })

  })
</script>
</body>
</html>